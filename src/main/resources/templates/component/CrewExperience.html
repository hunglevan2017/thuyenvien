<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="layout/layout">
   <head>
      <title>Header</title>
   </head>
   <body>
      <!--  table-responsive -->
      <div class="content" layout:fragment="content" id="root" >
         <div class="row"  >
            <div class="col-md-8">
               <div class="card">
                  <div class="card-header" v-if="profile.seaThongTinThuyenVien">
                     <h5 class="title" style="color:#f96332">
                        <a style="color:black"   :href="'/crew/' + profile.seaThongTinThuyenVien.id " v-if=" profile.seaThongTinThuyenVien.id != null ">  Profile  </a>
                        <a style="color:black" :href="'/crew/resume/' + profile.seaThongTinThuyenVien.id " v-if=" profile.seaThongTinThuyenVien.id != null "> | Resumes  </a>
                        | Experience 
                        <a style="color:black"  :href="'/crew/certificate/' + + profile.seaThongTinThuyenVien.id" v-if=" profile.seaThongTinThuyenVien.id != null "> | Certificate  </a>
                        <a style="color:black"   :href="'/crew/rank/' + + profile.seaThongTinThuyenVien.id" v-if=" profile.seaThongTinThuyenVien.id != null "> | Rank  </a>
                     </h5>
                  </div>
                  <div v-show="debug">
       
                  </div>
                  <ul v-if="errors && errors.length" id="error_id">
                     <li v-for="error of errors" style="color:red">
                        {{error.message}}
                     </li>
                  </ul>
                  <div class="card-body">
                     <h6>Oil - Chemical - Gas</h6>
                     <div class="nav navbar-right panel_toolbox">
                        <button data-id="0" type="button" class="btn btn-primary btn-xs experience-add" > <i class="fa fa-plus"> </i>  Add</button>
                     </div>
                     <div id="div_kinhnghiemlamviec">
                        <table id="kinhnghiemlamviec"
                           class="table table-striped table-bordered dataTable no-footer jambo_table bulk_action"
                           style="width: 100%">
                           <thead>
                           </thead>
                        </table>
                     </div>
                  </div>
               </div>
               
               <div class="card">
                  <div class="card-body">
                     <h6>Others</h6>
                     <div class="nav navbar-right panel_toolbox">
                     
                     </div>
                     <div id="div_kinhnghiemlamviec_other">
                        <table id="kinhnghiemlamviec_other"
                           class="table table-striped table-bordered dataTable no-footer jambo_table bulk_action"
                           style="width: 100%">
                           <thead>
                           </thead>
                        </table>
                     </div>
                  </div>
               </div>
               
               
               
               
            </div>
            <div class="col-md-4">
               <div class="card card-user">
                  <div class="image">
                     <img th:src="@{/images/bg5.jpg}" alt="...">
                  </div>
                  <div class="card-body">
                     <div class="author">
                        <a href="#">
                           <div v-if="profile.seaFile && profile.seaFile.name" >
                              <img  v-if="profile.seaFile" class="avatar border-gray" v-bind:src="profile.seaFile.name" alt="..." style="margin-bottom: 0.5em;">
                           </div>
                           <div v-else>
                              <img class="avatar border-gray" th:src="@{/images/picture.jpg}" alt="..." style="margin-bottom: 0.5em;">
                           </div>
                           <h5 class="title rightProfile" style="margin-bottom: 0.5em;" v-if="profile.seaThongTinThuyenVien" >{{profile.seaThongTinThuyenVien.hoten}}</h5>
                        </a>
                        <div v-if="profile.seaThongTinThuyenVien">
                           <div class="form-group input-group" v-if="profile.seaThongTinThuyenVien.ngaysinh">
                              <div class="input-group-prepend">
                                 <span class="input-group-text"> <i class="fa fa-birthday-cake"></i> </span>
                              </div>
                              <input  class="form-control"  type="text"  v-model="profile.seaThongTinThuyenVien.ngaysinh" readonly style="background-color:white" >
                           </div>
                           <div class="form-group input-group"  v-if="profile.shortProfileCrew.status_ship!=null ">
                              <div class="input-group-prepend">
                                 <span class="input-group-text"> <i class="fa  fa-exclamation-circle"></i> </span>
                              </div>
                              <input  class="form-control rightProfile"  type="text" value="On board" v-bind:value="profile.shortProfileCrew.status_ship"  readonly style="background-color:white"  >
                           </div>
                           <div class="form-group input-group" v-if=" profile.shortProfileCrew.tauOffHoacOnGanNhat!=null">
                              <div class="input-group-prepend">
                                 <span class="input-group-text"> <i class="fa  fa-ship"></i> </span>
                              </div>
                              <input  class="form-control rightProfile"  type="text"  v-bind:value="profile.shortProfileCrew.tauOffHoacOnGanNhat" readonly style="background-color:white" >
                           </div>
                           <div class="form-group input-group" v-if=" profile.shortProfileCrew.ngayOffHoacOnGanNhat">
                              <div class="input-group-prepend">
                                 <span class="input-group-text"> <i class="fa fa-calendar-alt"></i> </span>
                              </div>
                              <input  class="form-control rightProfile"  type="text"  v-bind:value="profile.shortProfileCrew.ngayOffHoacOnGanNhat" readonly style="background-color:white" >
                           </div>
                           <div class="form-group input-group" v-if="profile.seaThongTinThuyenVien.chucdanhtheochuyenmonid != null">
                              <div class="input-group-prepend">
                                 <span class="input-group-text"> <i class="fa  fa-exclamation-circle"></i> </span>
                              </div>
                              <input  class="form-control rightProfile"  type="text"  v-bind:value="'COMP.CERT : ' + profile.seaThongTinThuyenVien.chucdanhtheochuyenmonid  " readonly style="background-color:white">
                           </div>
                           <div class="form-group input-group" v-if="profile.shortProfileCrew.chucdanh != null ">
                              <div class="input-group-prepend">
                                 <span class="input-group-text"> <i class="fa  fa-exclamation-circle"></i> </span>
                              </div>
                              <input  class="form-control rightProfile"  type="text"  v-bind:value="'ONBROARD : ' + profile.shortProfileCrew.chucdanh" readonly style="background-color:white">
                           </div>
                           <div class="form-group input-group" v-if=" profile.seaThongTinThuyenVien.email">
                              <div class="input-group-prepend">
                                 <span class="input-group-text"> <i class="fa fa-envelope"></i> </span>
                              </div>
                              <input  class="form-control rightProfile" placeholder="Email address" type="email"  v-bind:value="profile.seaThongTinThuyenVien.email" readonly style="background-color:white">
                           </div>
                           <div class="form-group input-group" v-if="profile.seaThongTinThuyenVien.dtdidong != null">
                              <div class="input-group-prepend">
                                 <span class="input-group-text"> <i class="fa fa-phone"></i> </span>
                              </div>
                              <input  class="form-control"  type="text"  v-bind:value=" 'Mobile : ' + profile.seaThongTinThuyenVien.dtdidong " readonly style="background-color:white">
                           </div>
                           <div class="form-group input-group" v-if=" profile.seaThongTinThuyenVien.dtnha != null ">
                              <div class="input-group-prepend">
                                 <span class="input-group-text"> <i class="fa fa-phone"></i> </span>
                              </div>
                              <input  class="form-control"  type="text"  v-bind:value="'Home : ' + profile.seaThongTinThuyenVien.dtnha" readonly style="background-color:white">
                           </div>
                           <div class="form-group input-group" v-if="profile.seaThongTinThuyenVien.diachitamchu != null">
                              <textarea rows="20" cols="100" class="form-control"  v-bind:value="'Address : ' +profile.seaThongTinThuyenVien.diachitamchu" ></textarea>
                           </div>
                           <div class="form-group input-group">
                              <a id="btnSave" class="btn " style="background: #f96332;color: white;" v-on:click="Save"><i class="fa fa-edit m-right-xs" ></i>Save Profile</a>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
       
         <script>
        
         var tableKinhNghiemLamViec;
         var tableKinhNghiemLamViecOther;
        
         new Vue({
        	    el: '#root',
        	    data: {
        	        profile: {},
        	        debug: false,
        	        errors: [],
        	        
        	    },
        	    mounted() {
        	    	var columnDefs = [{"title": "STT","targets": 0},
      				  { 
    					"targets": 1,
    					"visible": false,
    	                "searchable": false
    				  },
    				  {"title": "COMPANY","targets": 2,"width":"20%"
    				  },
    				  
    				  {"title": "VESSEL NAME","targets": 3},
    				  {"title": "VESSEL TYPE","targets": 4},
    				  {"title": "GRT/M.EP (MT/KW)","targets": 5},
    				  {"title": "RANK","targets": 6},
    				  {
    					  "title": "SIGN ON",
    					  "targets": 7,
    		                "render": function (data) {
    		                	if(isNaN(data))
    		                	{
    		                		return '';
    		                	}
    		                	else
    		                		return formatDate(data);
    		                }
    				  },
    				  {
    					  "title": "SIGN OFF",
    					  "targets": 8,
    		                "render": function (data) {
    		                	if(isNaN(data))
    		                	{
    		                		return '';
    		                	}
    		                	else
    		                		return formatDate(data);
    		                }
    				  },
    				  {
    					  "title": "MONTHS",
    					  "targets": 9,
    					  "render": function (data, type, row, meta) {
    						  var remainder = (data.denngay- data.tungay) ;
    						  var month = remainder / (1000*60*60*24*30);
    						  
    						   return month.toFixed(2);
    	                   } 
    				  },
    				  {
    					  "title": "",
    					  "targets":10,
    	                  "render": function (data, type, row, meta) {  
    	                	  var edit = '<a href="javascript:void(0)"  class="experience-edit" data-id=' + row['id'] + ' > Edit</a>';
    	                	  var remove = '<a href="javascript:void(0)" class="experience-delete" data-id=' + row['id'] + ' > Delete</a>';
    	                	   return edit + remove;      
    	                   }
    				  }
    				  ];
		
		    	      var aoData =  [{ "mData": "stt","defaultContent":""},
		 				 { "mData": "id", "defaultContent":"" },
						 { "mData": "tencongty", "defaultContent":"" },
					     { "mData": "tentau", "defaultContent":"" },
					  	 { "mData": "loaitau_text", "defaultContent":"" },
						 { "mData": "trongtai", "defaultContent":"" },
						 { "mData": "chucdanh_text", "defaultContent":"" },
						 { "mData": "tungay", "defaultContent":"" },
						 { "mData": "denngay", "defaultContent":"" },
						 { "mData": null},
						 { "mData": null}
						 
						 ];
        	        this.LoadDataKinhNghiemLamViec(columnDefs,aoData);
        	        this.LoadDataKinhNghiemLamViecOther(columnDefs,aoData);
        	    },
        	    computed: {},
        	    methods: {
        	    	LoadDataKinhNghiemLamViec(columnDefs,aoData) {
        	    		   axios.get(_ctx + "crew/profile/" + getLastParameterOnURL() )
       	                .then(response => {
       	                    this.profile = response.data;
       	                    if (this.profile.seaFile && this.profile.seaFile.name) {
       	                        this.profile.seaFile.name = _ctx + 'disk/' + this.profile.seaFile.name;
       	                    }
       	                })
       	                .catch(e => {
       	                    this.errors.push(e)
       	                });
        	    		   
        	            axios.get(_ctx + "crew/experience/" + getLastParameterOnURL () )
    	                .then(response => {
    	                    tableKinhNghiemLamViec = $('#kinhnghiemlamviec').DataTable({
    	                         data: response.data,
    	                        "columnDefs": columnDefs,
    	                        "aoColumns": aoData,
    	                        "bInfo": false,
    	                        "bPaginate": false,
    	                        "searching": false,
    	                        "fnRowCallback": function(nRow, aData, iDisplayIndex) {
    	                            var index = iDisplayIndex + 1;
    	                            $('td:eq(0)', nRow).html(index);
    	                            return nRow;
    	                        },
    	                        "createdRow": function(row, data, dataIndex, full) {
    	                            $(row).attr('data-id', data.id);
    	                        }
    	                        
    	                    });
    	                    
    	                    var url = _ctx + 'editExperience/';
    	            		initEventClickForEditOrDelete("kinhnghiemlamviec",".experience-edit",url);
    	            		
    	            		url = _ctx + 'deleteExperience/';
    	            		initEventClickForEditOrDelete("kinhnghiemlamviec",".experience-delete",url);
    	            		
    	            		$( ".experience-add" ).bind( "click", function() {
    	            			popupModalAdd( _ctx + 'editExperience/0' );
    	            		});
    	            		
    	                });
        	        },
        	        LoadDataKinhNghiemLamViecOther(columnDefs,aoData) {

        	            axios.get(_ctx + "crew/experienceOther/" + getLastParameterOnURL() )
    	                .then(response => {
    	                    
    	                    
    	                    
    	                	tableKinhNghiemLamViecOther = $('#kinhnghiemlamviec_other').DataTable({
    	                        data: response.data,
    	                        "columnDefs": columnDefs,
    	                        "aoColumns": aoData,
    	                        "bInfo": false,
    	                        "bPaginate": false,
    	                        "searching": false,
    	                        "fnRowCallback": function(nRow, aData, iDisplayIndex) {
    	                            var index = iDisplayIndex + 1;
    	                            $('td:eq(0)', nRow).html(index);
    	                            return nRow;
    	                        },
    	                        "createdRow": function(row, data, dataIndex, full) {
    	                            $(row).attr('data-id', data.id);
    	                        }
    	                        
    	                    });
    	                    
    	                    var url = _ctx + 'editExperience/';
    	            		initEventClickForEditOrDelete("kinhnghiemlamviec_other",".experience-edit",url);
    	            		
    	            		url = _ctx + 'deleteExperience/';
    	            		initEventClickForEditOrDelete("kinhnghiemlamviec_other",".experience-delete",url);
    	       
    	                });
        	        },
        	        ExportCertificate(){
        	        	window.location = $('#PageContext').val() + "report/Certificate/" +  getLastParameterOnURL();
        	        },
        	        Save: function(event) {

        	            //Validate Form
        	            this.errors = [];
        	            console.log(this.profile.seaThongTinThuyenVien.hoten);
        	            if (this.profile.seaThongTinThuyenVien.hoten == null) {
        	                this.errors.push({
        	                    message: "Name required."
        	                });
        	            }

        	            if (this.profile.seaThongTinThuyenVien.cmnd == null) {
        	                this.errors.push({
        	                    message: "ID Card required."
        	                });
        	            }
        	            if (!this.errors.length) {
        	                // Call Insert
        	                axios.post(_ctx + "crew/save", this.profile)
        	                    .then(response => {
        	                        alert("Success");
        	                        this.LoadData();
        	                    })
        	                    .catch(e => {
        	                        this.errors.push(e)
        	                    })
        	            }
        	        }

        	    }

        	});
         </script>
      </div>
   </body>
</html>